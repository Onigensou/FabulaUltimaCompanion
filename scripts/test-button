// fu-utils.js — Foundry VTT v12
// Exposes a single global function: FU.applyAction(opts)

Hooks.once("init", () => {
  // Global namespace (safe + reuse)
  const FU = (window.FU ??= {});

  /**
   * Apply button logic (DOM-free).
   * @param {object} opts
   * @param {string} [opts.chatMsgId]
   * @param {object} [opts.payload]
   * @returns {Promise<{ok:boolean, message?:string, appliedBy?:string, code?:string}>}
   */
  FU.applyAction = async function applyAction(opts = {}) {
    if (!game.user?.isGM) {
      return { ok: false, code: "not-gm", message: "Only the GM can Apply." };
    }

    const { chatMsgId = "(unknown)", payload = {} } = opts;

    // --- POC behavior; replace with real logic later ---
    console.log(`[fu-utils] Apply OK by GM ${game.user.name} on message ${chatMsgId}`, { payload });

    // Example (later): call your damage macro here
    // const adv = game.macros.getName("AdvanceDamage");
    // if (!adv) return { ok:false, code:"missing-macro", message:'Macro "AdvanceDamage" not found.' };
    // await adv.execute({ __AUTO: true, __PAYLOAD: payload });

    return { ok: true, appliedBy: game.user.name, message: "Applied." };
  };

  console.log("[fu-utils] init — FU.applyAction is ready");
});
